# pinyin_map.py

import json
import os

# 声母映射
initials = {
    'b': '玻',
    'p': '坡',
    'm': '摸',
    'f': '佛',
    'd': '得',
    't': '特',
    'n': '讷',
    'l': '勒',
    'g': '哥',
    'k': '科',
    'h': '喝',
    'j': '基',
    'q': '欺',
    'x': '希',
    'zh': '知',
    'ch': '蚩',
    'sh': '诗',
    'r': '日',
    'z': '资',
    'c': '雌',
    's': '思',
    'y': '医',
    'w': '屋',
}

# 韵母映射（按拼音标准顺序排列）
finals = {
    # 单韵母
    'a': '啊',    # ā
    'o': '哦',    # ō
    'e': '鹅',    # ē
    'i': '衣',    # ī
    'u': '乌',    # ū
    'v': '迂',    # ǖ
    'ü': '迂',    # ǖ

    # 复韵母
    'ai': '哀',  # āi
    'ei': '诶',  # ēi
    'ui': '威',  # ūi
    'ao': '熬',  # āo
    'ou': '欧',  # ōu
    'iu': '优',  # īu
    'ie': '耶',  # īe
    've': '约',  # ǖe
    'ǖe': '约',  # ǖe
    'er': '儿',  # ēr

    # 鼻韵母
    'an': '安',  # ān
    'en': '恩',  # ēn
    'in': '因',  # īn
    'un': '温',  # ūn
    'vn': '晕',  # ǖn
    'ün': '晕',  # ǖn

    'ang': '昂',  # āng
    'eng': '亨',  # ēng
    'ing': '英',  # īng
    'ong': '翁',  # ōng
}

# 整体认读音节
whole_readings = {
    'zhi': '织',
    'chi': '吃',
    'shi': '狮',
    'ri': '日',
    'zi': '资',
    'ci': '刺',
    'si': '丝',
    'yi': '衣',
    'wu': '乌',
    'yu': '鱼',
    'ye': '耶',
    'yue': '月',
    'yuan': '渊',
    'yin': '因',
    'yun': '晕',
    'ying': '鹰',
}

# 特殊字的读音
special_words = {
    'a': '阿',
    'ai': '哎',
    'an': '安',
    'ang': '昂',
    'ao': '奥',
    'ba': '把',
    'bai': '白',
    'ban': '半',
    'bang': '帮',
    'bao': '包',
    'bei': '贝',
    'ben': '本',
    'beng': '崩',
    'bi': '比',
    'bian': '变',
    'biao': '表',
    'bie': '别',
    'bin': '宾',
    'bing': '冰',
    'bo': '波',
    'bu': '不',
    'ca': '擦',
    'cai': '才',
    'can': '参',
    'cang': '仓',
    'cao': '草',
    'ce': '册',
    'cen': '岑',
    'ceng': '层',
    'cha': '查',
    'chai': '柴',
    'chan': '产',
    'chang': '厂',
    'chao': '超',
    'che': '车',
    'chen': '尘',
    'cheng': '成',
    'chi': '尺',
    'chong': '虫',
    'chou': '丑',
    'chu': '出',
    'chua': '欻',
    'chuai': '揣',
    'chuan': '船',
    'chuang': '床',
    'chui': '吹',
    'chun': '春',
    'chuo': '戳',
    'ci': '词',
    'cong': '从',
    'cou': '凑',
    'cu': '粗',
    'cuan': '窜',
    'cui': '催',
    'cun': '寸',
    'cuo': '错',
    'da': '大',
    'dai': '带',
    'dan': '单',
    'dang': '当',
    'dao': '刀',
    'de': '的',
    'dei': '得',
    'den': '扽',
    'deng': '灯',
    'di': '弟',
    'dia': '嗲',
    'dian': '点',
    'diao': '掉',
    'die': '爹',
    'ding': '丁',
    'diu': '丢',
    'dong': '东',
    'dou': '都',
    'du': '都',
    'duan': '短',
    'dui': '对',
    'dun': '顿',
    'duo': '多',
    'e': '鹅',
    'ei': '诶',
    'en': '恩',
    'er': '儿',
    'fa': '发',
    'fan': '反',
    'fang': '房',
    'fei': '飞',
    'fen': '分',
    'feng': '风',
    'fo': '佛',
    'fou': '否',
    'fu': '父',
    'ga': '嘎',
    'gai': '该',
    'gan': '赶',
    'gang': '刚',
    'gao': '高',
    'ge': '个',
    'gei': '给',
    'gen': '根',
    'geng': '更',
    'gong': '工',
    'gou': '狗',
    'gu': '故',
    'gua': '挂',
    'guai': '怪',
    'guan': '关',
    'guang': '广',
    'gui': '归',
    'gun': '滚',
    'guo': '果',
    'ha': '哈',
    'hai': '孩',
    'han': '汉',
    'hang': '航',
    'hao': '好',
    'he': '和',
    'hei': '黑',
    'hen': '很',
    'heng': '横',
    'hong': '红',
    'hou': '后',
    'hu': '户',
    'hua': '画',
    'huai': '坏',
    'huan': '欢',
    'huang': '黄',
    'hui': '回',
    'hun': '婚',
    'huo': '火',
    'ji': '几',
    'jia': '加',
    'jian': '见',
    'jiang': '江',
    'jiao': '交',
    'jie': '姐',
    'jin': '今',
    'jing': '京',
    'jiong': '窘',
    'jiu': '九',
    'ju': '句',
    'juan': '卷',
    'jue': '决',
    'jun': '军',
    'ka': '卡',
    'kai': '开',
    'kan': '看',
    'kang': '康',
    'kao': '考',
    'ke': '可',
    'ken': '肯',
    'keng': '坑',
    'kong': '空',
    'kou': '口',
    'ku': '苦',
    'kua': '夸',
    'kuai': '快',
    'kuan': '宽',
    'kuang': '狂',
    'kui': '亏',
    'kun': '困',
    'kuo': '扩',
    'la': '拉',
    'lai': '来',
    'lan': '蓝',
    'lang': '浪',
    'lao': '老',
    'le': '了',
    'lei': '泪',
    'leng': '冷',
    'li': '立',
    'lia': '俩',
    'lian': '莲',
    'liang': '亮',
    'liao': '料',
    'lie': '列',
    'lin': '林',
    'ling': '零',
    'liu': '六',
    'long': '龙',
    'lou': '楼',
    'lu': '路',
    'luan': '乱',
    'lun': '论',
    'luo': '落',
    'lv': '绿',
    'lü': '绿',
    'lüe': '略',
    'ma': '妈',
    'mai': '买',
    'man': '满',
    'mang': '忙',
    'mao': '猫',
    'me': '么',
    'mei': '没',
    'men': '门',
    'meng': '梦',
    'mi': '米',
    'mian': '面',
    'miao': '苗',
    'mie': '灭',
    'min': '民',
    'ming': '明',
    'miu': '谬',
    'mo': '模',
    'mou': '某',
    'mu': '木',
    'na': '那',
    'ne': '呢',
    'nai': '奶',
    'nan': '男',
    'nang': '囊',
    'nao': '脑',
    'nei': '内',
    'nen': '嫩',
    'neng': '能',
    'ni': '你',
    'nian': '年',
    'niang': '娘',
    'niao': '鸟',
    'nie': '捏',
    'nin': '您',
    'ning': '宁',
    'niu': '牛',
    'nong': '农',
    'nou': '耨',
    'nu': '努',
    'nuan': '暖',
    'nue': '虐',
    'nuo': '挪',
    'nv': '女',
    'nü': '女',
    'nüe': '虐',
    'o': '哦',
    'ou': '欧',
    'pa': '怕',
    'pai': '排',
    'pan': '盘',
    'pang': '旁',
    'pao': '跑',
    'pei': '配',
    'pen': '喷',
    'peng': '朋',
    'pi': '皮',
    'pian': '片',
    'piao': '飘',
    'pie': '撇',
    'pin': '品',
    'ping': '苹',
    'po': '破',
    'pou': '剖',
    'pu': '普',
    'qi': '起',
    'qia': '恰',
    'qian': '前',
    'qiang': '强',
    'qiao': '桥',
    'qie': '切',
    'qin': '亲',
    'qing': '青',
    'qiong': '穷',
    'qiu': '秋',
    'qu': '去',
    'quan': '全',
    'que': '却',
    'qun': '群',
    'ran': '然',
    'rang': '让',
    'rao': '绕',
    're': '热',
    'ren': '人',
    'reng': '扔',
    'ri': '日',
    'rong': '容',
    'rou': '肉',
    'ru': '入',
    'ruan': '软',
    'rui': '瑞',
    'run': '润',
    'ruo': '若',
    'sa': '撒',
    'sai': '赛',
    'san': '三',
    'sang': '桑',
    'sao': '扫',
    'se': '色',
    'sen': '森',
    'seng': '僧',
    'sha': '沙',
    'shai': '晒',
    'shan': '山',
    'shang': '上',
    'shao': '少',
    'she': '社',
    'shen': '什',
    'sheng': '生',
    'shi': '石',
    'shou': '手',
    'shu': '叔',
    'shua': '刷',
    'shuai': '帅',
    'shuan': '栓',
    'shuang': '双',
    'shui': '水',
    'shun': '顺',
    'shuo': '说',
    'si': '四',
    'song': '送',
    'sou': '搜',
    'su': '苏',
    'suan': '算',
    'sui': '岁',
    'sun': '孙',
    'suo': '所',
    'ta': '它',
    'tai': '台',
    'tan': '谈',
    'tang': '糖',
    'tao': '桃',
    'te': '特',
    'teng': '疼',
    'ti': '题',
    'tian': '天',
    'tiao': '条',
    'tie': '铁',
    'ting': '听',
    'tong': '同',
    'tou': '头',
    'tu': '土',
    'tuan': '团',
    'tui': '推',
    'tun': '吞',
    'tuo': '脱',
    'wa': '蛙',
    'wai': '外',
    'wan': '玩',
    'wang': '往',
    'wei': '为',
    'wen': '问',
    'weng': '翁',
    'wo': '我',
    'wu': '五',
    'xi': '西',
    'xia': '下',
    'xian': '先',
    'xiang': '向',
    'xiao': '小',
    'xie': '鞋',
    'xin': '心',
    'xing': '杏',
    'xiong': '雄',
    'xiu': '修',
    'xu': '许',
    'xuan': '选',
    'xue': '学',
    'xun': '寻',
    'ya': '牙',
    'yan': '眼',
    'yang': '羊',
    'yao': '要',
    'ye': '爷',
    'yi': '衣',
    'yin': '音',
    'ying': '影',
    'yo': '哟',
    'yong': '用',
    'you': '又',
    'yu': '雨',
    'yuan': '院',
    'yue': '月',
    'yun': '云',
    'za': '杂',
    'zai': '在',
    'zan': '咱',
    'zang': '脏',
    'zao': '早',
    'ze': '则',
    'zei': '贼',
    'zen': '怎',
    'zeng': '增',
    'zha': '扎',
    'zhai': '摘',
    'zhan': '站',
    'zhang': '长',
    'zhao': '找',
    'zhe': '着',
    'zhen': '真',
    'zheng': '正',
    'zhi': '只',
    'zhong': '中',
    'zhou': '周',
    'zhu': '竹',
    'zhua': '抓',
    'zhuai': '拽',
    'zhuan': '转',
    'zhuang': '装',
    'zhui': '追',
    'zhun': '准',
    'zhuo': '桌',
    'zi': '自',
    'zong': '总',
    'zou': '走',
    'zu': '足',
    'zuan': '钻',
    'zui': '最',
    'zun': '尊',
    'zuo': '左',
}

# 合并所有映射
pinyin_to_hanzi = {
    **initials,
    **finals,
    **whole_readings,
    **special_words,
}

# 自定义英文单词到拼音的映射
CUSTOM_PINYIN_MAP = {
    'a': 'ā',
    'ai': 'āi',
    'an': 'ān',
    'ang': 'áng',
    'ao': 'ào',
    'ba': 'bǎ',
    'bai': 'bái',
    'ban': 'bàn',
    'bang': 'bāng',
    'bao': 'bāo',
    'bei': 'bèi',
    'ben': 'běn',
    'beng': 'bēng',
    'bi': 'bǐ',
    'bian': 'biàn',
    'biao': 'biǎo',
    'bie': 'bié',
    'bin': 'bīn',
    'bing': 'bīng',
    'bo': 'bō',
    'bu': 'bù',
    'ca': 'cā',
    'cai': 'cái',
    'can': 'cān',
    'cang': 'cāng',
    'cao': 'cǎo',
    'ce': 'cè',
    'cen': 'cén',
    'ceng': 'céng',
    'cha': 'chá',
    'chai': 'chái',
    'chan': 'chǎn',
    'chang': 'chǎng',
    'chao': 'chāo',
    'che': 'chē',
    'chen': 'chén',
    'cheng': 'chéng',
    'chi': 'chǐ',
    'chong': 'chóng',
    'chou': 'chǒu',
    'chu': 'chū',
    'chua': 'chuā',
    'chuai': 'chuāi',
    'chuan': 'chuán',
    'chuang': 'chuáng',
    'chui': 'chuī',
    'chun': 'chūn',
    'chuo': 'chuō',
    'ci': 'cí',
    'cong': 'cóng',
    'cou': 'còu',
    'cu': 'cū',
    'cuan': 'cuàn',
    'cui': 'cuī',
    'cun': 'cùn',
    'cuo': 'cuò',
    'da': 'dà',
    'dai': 'dài',
    'dan': 'dān',
    'dang': 'dāng',
    'dao': 'dāo',
    'de': 'de',
    'dei': 'dé',
    'den': 'dèn',
    'deng': 'dēng',
    'di': 'dì',
    'dia': 'diē',
    'dian': 'diǎn',
    'diao': 'diào',
    'die': 'diē',
    'ding': 'dīng',
    'diu': 'diū',
    'dong': 'dōng',
    'dou': 'dōu',
    'du': 'dōu',
    'duan': 'duǎn',
    'dui': 'duì',
    'dun': 'dùn',
    'duo': 'duō',
    'e': 'é',
    'ei': 'éi',
    'en': 'ēn',
    'er': 'ér',
    'fa': 'fā',
    'fan': 'fǎn',
    'fang': 'fáng',
    'fei': 'fēi',
    'fen': 'fēn',
    'feng': 'fēng',
    'fo': 'fú',
    'fou': 'fǒu',
    'fu': 'fù',
    'ga': 'gā',
    'gai': 'gāi',
    'gan': 'gǎn',
    'gang': 'gāng',
    'gao': 'gāo',
    'ge': 'gè',
    'gei': 'gěi',
    'gen': 'gēn',
    'geng': 'gèng',
    'gong': 'gōng',
    'gou': 'gǒu',
    'gu': 'gù',
    'gua': 'guà',
    'guai': 'guài',
    'guan': 'guān',
    'guang': 'guǎng',
    'gui': 'guī',
    'gun': 'gǔn',
    'guo': 'guǒ',
    'ha': 'hā',
    'hai': 'hái',
    'han': 'hàn',
    'hang': 'háng',
    'hao': 'hǎo',
    'he': 'hé',
    'hei': 'hēi',
    'hen': 'hěn',
    'heng': 'héng',
    'hong': 'hóng',
    'hou': 'hòu',
    'hu': 'hù',
    'hua': 'huà',
    'huai': 'huài',
    'huan': 'huān',
    'huang': 'huáng',
    'hui': 'huí',
    'hun': 'hūn',
    'huo': 'huǒ',
    'ji': 'jǐ',
    'jia': 'jiā',
    'jian': 'jiàn',
    'jiang': 'jiāng',
    'jiao': 'jiāo',
    'jie': 'jiě',
    'jin': 'jīn',
    'jing': 'jīng',
    'jiong': 'jiǒng',
    'jiu': 'jiǔ',
    'ju': 'jù',
    'juan': 'juǎn',
    'jue': 'jué',
    'jun': 'jūn',
    'ka': 'kǎ',
    'kai': 'kāi',
    'kan': 'kàn',
    'kang': 'kāng',
    'kao': 'kǎo',
    'ke': 'kě',
    'ken': 'kěn',
    'keng': 'kēng',
    'kong': 'kōng',
    'kou': 'kǒu',
    'ku': 'kǔ',
    'kua': 'kuā',
    'kuai': 'kuài',
    'kuan': 'kuān',
    'kuang': 'kuáng',
    'kui': 'kuī',
    'kun': 'kùn',
    'kuo': 'kuò',
    'la': 'lā',
    'lai': 'lái',
    'lan': 'lán',
    'lang': 'làng',
    'lao': 'lǎo',
    'le': 'le',
    'lei': 'lèi',
    'leng': 'lěng',
    'li': 'lì',
    'lia': 'liǎ',
    'lian': 'lián',
    'liang': 'liàng',
    'liao': 'liào',
    'lie': 'liè',
    'lin': 'lín',
    'ling': 'líng',
    'liu': 'liù',
    'long': 'lóng',
    'lou': 'lóu',
    'lu': 'lù',
    'luan': 'luàn',
    'lun': 'lùn',
    'luo': 'luò',
    'lv': 'lǜ',
    'lü': 'lǜ',
    'lüe': 'lüè',
    'ma': 'mā',
    'mai': 'mǎi',
    'man': 'mǎn',
    'mang': 'máng',
    'mao': 'māo',
    'me': 'me',
    'mei': 'méi',
    'men': 'mén',
    'meng': 'mèng',
    'mi': 'mǐ',
    'mian': 'miàn',
    'miao': 'miáo',
    'mie': 'miè',
    'min': 'mín',
    'ming': 'míng',
    'miu': 'miù',
    'mo': 'mó',
    'mou': 'mǒu',
    'mu': 'mù',
    'na': 'nà',
    'ne': 'ne',
    'nai': 'nǎi',
    'nan': 'nán',
    'nang': 'náng',
    'nao': 'nǎo',
    'nei': 'nèi',
    'nen': 'nèn',
    'neng': 'néng',
    'ni': 'nǐ',
    'nian': 'nián',
    'niang': 'niáng',
    'niao': 'niǎo',
    'nie': 'niē',
    'nin': 'nín',
    'ning': 'níng',
    'niu': 'niú',
    'nong': 'nóng',
    'nou': 'nòu',
    'nu': 'nǔ',
    'nuan': 'nuǎn',
    'nue': 'nüè',
    'nuo': 'nuó',
    'nv': 'nǚ',
    'nü': 'nǚ',
    'nüe': 'nüè',
    'o': 'ó',
    'ou': 'ōu',
    'pa': 'pà',
    'pai': 'pái',
    'pan': 'pán',
    'pang': 'páng',
    'pao': 'pǎo',
    'pei': 'pèi',
    'pen': 'pēn',
    'peng': 'péng',
    'pi': 'pí',
    'pian': 'piàn',
    'piao': 'piāo',
    'pie': 'piē',
    'pin': 'pǐn',
    'ping': 'píng',
    'po': 'pò',
    'pou': 'pōu',
    'pu': 'pǔ',
    'qi': 'qǐ',
    'qia': 'qià',
    'qian': 'qián',
    'qiang': 'qiáng',
    'qiao': 'qiáo',
    'qie': 'qiè',
    'qin': 'qīn',
    'qing': 'qīng',
    'qiong': 'qióng',
    'qiu': 'qiū',
    'qu': 'qù',
    'quan': 'quán',
    'que': 'què',
    'qun': 'qún',
    'ran': 'rán',
    'rang': 'ràng',
    'rao': 'rào',
    're': 'rè',
    'ren': 'rén',
    'reng': 'rēng',
    'ri': 'rì',
    'rong': 'róng',
    'rou': 'ròu',
    'ru': 'rù',
    'ruan': 'ruǎn',
    'rui': 'ruì',
    'run': 'rùn',
    'ruo': 'ruò',
    'sa': 'sā',
    'sai': 'sài',
    'san': 'sān',
    'sang': 'sāng',
    'sao': 'sǎo',
    'se': 'sè',
    'sen': 'sēn',
    'seng': 'sēng',
    'sha': 'shā',
    'shai': 'shài',
    'shan': 'shān',
    'shang': 'shàng',
    'shao': 'shǎo',
    'she': 'shè',
    'shen': 'shén',
    'sheng': 'shēng',
    'shi': 'shí',
    'shou': 'shǒu',
    'shu': 'shū',
    'shua': 'shuā',
    'shuai': 'shuài',
    'shuan': 'shuān',
    'shuang': 'shuāng',
    'shui': 'shuǐ',
    'shun': 'shùn',
    'shuo': 'shuō',
    'si': 'sì',
    'song': 'sòng',
    'sou': 'sōu',
    'su': 'sū',
    'suan': 'suàn',
    'sui': 'suì',
    'sun': 'sūn',
    'suo': 'suǒ',
    'ta': 'tā',
    'tai': 'tái',
    'tan': 'tán',
    'tang': 'táng',
    'tao': 'táo',
    'te': 'tè',
    'teng': 'téng',
    'ti': 'tí',
    'tian': 'tiān',
    'tiao': 'tiáo',
    'tie': 'tiě',
    'ting': 'tīng',
    'tong': 'tóng',
    'tou': 'tóu',
    'tu': 'tǔ',
    'tuan': 'tuán',
    'tui': 'tuī',
    'tun': 'tūn',
    'tuo': 'tuō',
    'wa': 'wā',
    'wai': 'wài',
    'wan': 'wán',
    'wang': 'wǎng',
    'wei': 'wèi',
    'wen': 'wèn',
    'weng': 'wēng',
    'wo': 'wǒ',
    'wu': 'wǔ',
    'xi': 'xī',
    'xia': 'xià',
    'xian': 'xiān',
    'xiang': 'xiàng',
    'xiao': 'xiǎo',
    'xie': 'xié',
    'xin': 'xīn',
    'xing': 'xìng',
    'xiong': 'xióng',
    'xiu': 'xiū',
    'xu': 'xǔ',
    'xuan': 'xuǎn',
    'xue': 'xué',
    'xun': 'xún',
    'ya': 'yá',
    'yan': 'yǎn',
    'yang': 'yáng',
    'yao': 'yào',
    'ye': 'yé',
    'yi': 'yī',
    'yin': 'yīn',
    'ying': 'yǐng',
    'yo': 'yō',
    'yong': 'yòng',
    'you': 'yòu',
    'yu': 'yǔ',
    'yuan': 'yuàn',
    'yue': 'yuè',
    'yun': 'yún',
    'za': 'zá',
    'zai': 'zài',
    'zan': 'zán',
    'zang': 'zàng',
    'zao': 'zǎo',
    'ze': 'zé',
    'zei': 'zéi',
    'zen': 'zěn',
    'zeng': 'zēng',
    'zha': 'zhā',
    'zhai': 'zhāi',
    'zhan': 'zhàn',
    'zhang': 'zhǎng',
    'zhao': 'zhǎo',
    'zhe': 'zhe',
    'zhen': 'zhēn',
    'zheng': 'zhèng',
    'zhi': 'zhǐ',
    'zhong': 'zhōng',
    'zhou': 'zhōu',
    'zhu': 'zhú',
    'zhua': 'zhuā',
    'zhuai': 'zhuāi',
    'zhuan': 'zhuǎn',
    'zhuang': 'zhuāng',
    'zhui': 'zhuī',
    'zhun': 'zhǔn',
    'zhuo': 'zhuō',
    'zi': 'zì',
    'zong': 'zǒng',
    'zou': 'zǒu',
    'zu': 'zú',
    'zuan': 'zuān',
    'zui': 'zuì',
    'zun': 'zūn',
    'zuo': 'zuǒ',
}

def replace_custom_pinyin(text):
    """
    将自定义英文单词替换为指定拼音。
    """
    for word, pinyin in CUSTOM_PINYIN_MAP.items():
        text = text.replace(word, pinyin)
    return text

def get_hanzi_from_pinyin(pinyin_str):
    """
    统一拼音查汉字逻辑：
    1. 优先查pinyin_dict.json（用户自定义/动态扩展）
    2. 查本地special_words、whole_readings等静态字典
    """
    # 1. 查json字典
    dict_path = os.path.join(os.path.dirname(__file__), 'pinyin_dict.json')
    if os.path.exists(dict_path):
        try:
            with open(dict_path, 'r', encoding='utf-8') as f:
                d = json.load(f)
            hanzi = d.get(pinyin_str.lower())
            if hanzi:
                return hanzi
        except Exception:
            pass
    # 2. 查本地静态字典
    key = pinyin_str.lower()
    if key in special_words:
        return special_words[key]
    if key in whole_readings:
        return whole_readings[key]
    # 3. 查声母、韵母
    if key in initials:
        return initials[key]
    if key in finals:
        return finals[key]
    # 4. 没找到，返回原拼音
    return pinyin_str

def has_valid_pinyin_value(pinyin):
    """
    只检查 whole_readings、special_words、CUSTOM_PINYIN_MAP 是否有有效 value。
    声母和韵母单独出现不算有效拼音。
    """
    for d in [initials, finals, whole_readings, special_words, CUSTOM_PINYIN_MAP]:
        v = d.get(pinyin)
        if v:
            return True
    return False

def is_valid_pinyin_combination(initial, final):
    """
    校验声母和韵母组合是否合法，且有有效 value。
    """
    if not initial and final in finals and finals[final]:
        return True
    if initial in initials and final in finals:
        combined = initial + final
        # 检查 whole_readings、special_words、initials、finals
        for d in [whole_readings, special_words, initials, finals, CUSTOM_PINYIN_MAP]:
            v = d.get(combined)
            if v:
                return True
        # 也允许 initial+final 直接有 value
        return False
    return False